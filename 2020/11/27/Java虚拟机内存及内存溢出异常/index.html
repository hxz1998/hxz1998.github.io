<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.png">
  <link rel="mask-icon" href="/images/avatar.png" color="#222">
  <meta name="baidu-site-verification" content="code-gXPATQKqG4">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://jshub.com/css?family=Serif Noto SC Lato:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hxz1998.gitee.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Javaä¸C++ä¹‹é—´æœ‰ä¸€å µç”±å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯æ‰€å›´æˆçš„é«˜å¢™ï¼Œå¢™å¤–é¢çš„äººæƒ³è¿›æ¥ï¼Œå¢™é‡Œé¢çš„äººå´æƒ³å‡ºæ¥ã€‚  ä¸çŸ¥é“å…¶ä»–äººæƒ³å‡ºæ¥æ²¡ï¼Œåæ­£æˆ‘æ˜¯æ²¡æƒ³å‡ºæ¥ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªJVMçš„è¿è¡Œæ—¶å†…å­˜è¦è¿™æ ·è®¾è®¡ğŸ¤£ã€‚ ä»¥ä¸‹å†…å®¹ä¸­ï¼ŒJavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ç‰¹æŒ‡HotSpotè™šæ‹Ÿæœºã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Javaè™šæ‹Ÿæœºå†…å­˜åŠå†…å­˜æº¢å‡ºå¼‚å¸¸">
<meta property="og:url" content="https://hxz1998.gitee.io/2020/11/27/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%86%85%E5%AD%98%E5%8F%8A%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E5%BC%82%E5%B8%B8/index.html">
<meta property="og:site_name" content="CHerrY">
<meta property="og:description" content="Javaä¸C++ä¹‹é—´æœ‰ä¸€å µç”±å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯æ‰€å›´æˆçš„é«˜å¢™ï¼Œå¢™å¤–é¢çš„äººæƒ³è¿›æ¥ï¼Œå¢™é‡Œé¢çš„äººå´æƒ³å‡ºæ¥ã€‚  ä¸çŸ¥é“å…¶ä»–äººæƒ³å‡ºæ¥æ²¡ï¼Œåæ­£æˆ‘æ˜¯æ²¡æƒ³å‡ºæ¥ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªJVMçš„è¿è¡Œæ—¶å†…å­˜è¦è¿™æ ·è®¾è®¡ğŸ¤£ã€‚ ä»¥ä¸‹å†…å®¹ä¸­ï¼ŒJavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ç‰¹æŒ‡HotSpotè™šæ‹Ÿæœºã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/Dy57a8.jpg">
<meta property="article:published_time" content="2020-11-27T04:52:23.000Z">
<meta property="article:modified_time" content="2020-11-28T12:27:53.663Z">
<meta property="article:author" content="CHerrY">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="JVM">
<meta property="article:tag" content="è™šæ‹Ÿæœº">
<meta property="article:tag" content="JVMæ€§èƒ½è°ƒä¼˜">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.ax1x.com/2020/11/28/Dy57a8.jpg">

<link rel="canonical" href="https://hxz1998.gitee.io/2020/11/27/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%86%85%E5%AD%98%E5%8F%8A%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E5%BC%82%E5%B8%B8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Javaè™šæ‹Ÿæœºå†…å­˜åŠå†…å­˜æº¢å‡ºå¼‚å¸¸ | CHerrY</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CHerrY</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">é—¨å‰å¤§æ¡¥ä¸‹ï¼ŒC#C++ï¼Œå¿«æ¥å¿«æ¥æ•°ä¸€æ•°ï¼ŒJavaç…®é’è›™~</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾<span class="badge">46</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»<span class="badge">9</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£<span class="badge">42</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hxz1998.gitee.io/2020/11/27/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%86%85%E5%AD%98%E5%8F%8A%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E5%BC%82%E5%B8%B8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="CHerrY">
      <meta itemprop="description" content="ç®—æ³•åˆ†æï¼ŒåŸºç¡€æ¶æ„">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHerrY">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Javaè™šæ‹Ÿæœºå†…å­˜åŠå†…å­˜æº¢å‡ºå¼‚å¸¸
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-11-27 12:52:23" itemprop="dateCreated datePublished" datetime="2020-11-27T12:52:23+08:00">2020-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-11-28 20:27:53" itemprop="dateModified" datetime="2020-11-28T20:27:53+08:00">2020-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index"><span itemprop="name">JVM</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>5.8k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>5 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>  Javaä¸C++ä¹‹é—´æœ‰ä¸€å µç”±å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯æ‰€å›´æˆçš„é«˜å¢™ï¼Œå¢™å¤–é¢çš„äººæƒ³è¿›æ¥ï¼Œå¢™é‡Œé¢çš„äººå´æƒ³å‡ºæ¥ã€‚</p>
</blockquote>
<p>ä¸çŸ¥é“å…¶ä»–äººæƒ³å‡ºæ¥æ²¡ï¼Œåæ­£æˆ‘æ˜¯æ²¡æƒ³å‡ºæ¥ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªJVMçš„è¿è¡Œæ—¶å†…å­˜è¦è¿™æ ·è®¾è®¡ğŸ¤£ã€‚</p>
<p>ä»¥ä¸‹å†…å®¹ä¸­ï¼ŒJavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ç‰¹æŒ‡HotSpotè™šæ‹Ÿæœºã€‚</p>
<a id="more"></a>
<p>JVMå¯åŠ¨åï¼Œæ•´ä½“æ¥çœ‹ï¼Œä¼šæŠŠå‘æ“ä½œç³»ç»Ÿç”³è¯·åˆ°çš„å†…å­˜ç©ºé—´åˆ†æˆè¿™æ ·å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>ç¨‹åºè®¡æ•°å™¨åŒº</li>
<li>è™šæ‹Ÿæœºæ ˆ</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆ</li>
<li>å †</li>
<li>æ–¹æ³•åŒº</li>
</ol>
<p>å®ƒä»¬åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­éƒ½æœ‰ç›¸å…³è§„å®šå’Œè¯´æ˜ï¼Œåªæ˜¯æœ‰çš„åŒºåŸŸå…·ä½“å®ç°ç»†èŠ‚æ ¹æ®Javaè™šæ‹Ÿæœºå®ç°è€…æ¥å†³å®šï¼Œã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸åšå¼ºè¡Œè¦æ±‚ï¼Œä¾‹å¦‚<strong>æ–¹æ³•åŒº</strong>ã€‚ä¸‹é¢å¯¹è¿™å‡ ä¸ªéƒ¨åˆ†è¿›è¡Œè¯¦ç»†å™è¿°ï¼Œåœ¨å™è¿°è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸æ–­å‚è€ƒä¸‹é¢è¿™ä¸ªç¤ºæ„å›¾æ¥å¸®åŠ©ç†è§£ã€‚</p>
<p><img data-src="https://s3.ax1x.com/2020/11/28/Dy57a8.jpg" alt="Javaè¿è¡Œæ—¶å†…å­˜å¸ƒå±€"></p>
<h1 id="1-ç¨‹åºè®¡æ•°å™¨åŒºï¼ˆProgram-Counter-Registerï¼‰"><a href="#1-ç¨‹åºè®¡æ•°å™¨åŒºï¼ˆProgram-Counter-Registerï¼‰" class="headerlink" title="1. ç¨‹åºè®¡æ•°å™¨åŒºï¼ˆProgram Counter Registerï¼‰"></a>1. ç¨‹åºè®¡æ•°å™¨åŒºï¼ˆProgram Counter Registerï¼‰</h1><p>è¿™ä¸ªåŒºåŸŸå†…å®¹æŒ‡å‘å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œå­—èŠ‚ç è¡Œå·ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰åŒºåŸŸã€‚å’Œæ“ä½œç³»ç»Ÿé‡Œé¢çš„PCæŒ‡é’ˆç±»ä¼¼ï¼Œåªä¸è¿‡è¿™ä¸ªPCæŒ‡é’ˆæŒ‡å‘å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç è¡Œå·ï¼Œæ“ä½œç³»ç»Ÿçš„æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€æ¡æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ã€‚</p>
<p>éœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨æ‰§è¡ŒJavaç¨‹åºï¼Œé‚£ä¹ˆå¦‚ä¸Šæ‰€è¿°æŒ‡å‘å­—èŠ‚ç è¡Œå·ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯Nativeæ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒºåŸŸæ˜¯ç©ºï¼ˆUndefinedï¼‰çš„ã€‚</p>
<p>è¯¥åŒºåŸŸä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹é‡Œé¢æ²¡æœ‰ <code>OutOfMemoryError</code> é”™è¯¯çš„å®šä¹‰çš„åŒºåŸŸã€‚</p>
<h1 id="2-Javaè™šæ‹Ÿæœºæ ˆï¼ˆVM-Stackï¼‰"><a href="#2-Javaè™šæ‹Ÿæœºæ ˆï¼ˆVM-Stackï¼‰" class="headerlink" title="2. Javaè™šæ‹Ÿæœºæ ˆï¼ˆVM Stackï¼‰"></a>2. Javaè™šæ‹Ÿæœºæ ˆï¼ˆVM Stackï¼‰</h1><p>è¯¥åŒºåŸŸçš„å†…å®¹æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å†…å­˜æ¨¡å‹ï¼Œå…·ä½“æ¥è¯´ï¼Œå­˜æ”¾çš„æ˜¯<strong>æ ˆå¸§</strong>ï¼Œåœ¨æ ˆå¸§ä¸­ï¼Œå­˜æ”¾äº†å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆç­‰ä¿¡æ¯ï¼Œå½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª<strong>æ ˆå¸§</strong>æ¥è®°å½•ä¿¡æ¯ï¼Œæ–¹æ³•ä»è¢«è°ƒç”¨åˆ°è¿”å›çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±å¯¹åº”äº†æ ˆå¸§ä»å…¥æ ˆï¼ˆè™šæ‹Ÿæœºæ ˆï¼‰åˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚æ˜¾è€Œæ˜“è§ï¼Œè¿™ä¸ªåŒºåŸŸå¿…é¡»æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå¦åˆ™å°±æ··ä¹±äº†å‘€ğŸ˜‘ã€‚</p>
<p>è¿™ä¸ªåŒºåŸŸåœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­ï¼Œè¯¦ç»†å®šä¹‰äº†ä»¥ä¸‹å†…å®¹ï¼š</p>
<ol>
<li>å¦‚æœçº¿ç¨‹æ‰€åˆ›å»ºçš„æ ˆå¸§ä¸ªæ•°å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆæŠ›å‡º <code>StackOverflowError</code> å¼‚å¸¸ã€‚</li>
<li>å¦‚æœåœ¨åˆ›å»ºæ ˆå¸§çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºå†…å­˜ä¸è¶³æ‰€å¤±è´¥äº†ï¼Œåˆ™ä¼šæŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</li>
</ol>
<h2 id="2-1-è™šæ‹Ÿæœºæ ˆå¼‚å¸¸ç¤ºä¾‹ç¨‹åº"><a href="#2-1-è™šæ‹Ÿæœºæ ˆå¼‚å¸¸ç¤ºä¾‹ç¨‹åº" class="headerlink" title="2.1 è™šæ‹Ÿæœºæ ˆå¼‚å¸¸ç¤ºä¾‹ç¨‹åº"></a>2.1 è™šæ‹Ÿæœºæ ˆå¼‚å¸¸ç¤ºä¾‹ç¨‹åº</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * VM Args: -Xss128k</span></span><br><span class="line"><span class="comment"> * -Xss: å‡å°æ ˆå†…å­˜å®¹é‡</span></span><br><span class="line"><span class="comment"> * è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæµ‹è¯•ï¼ŒæŠ›å‡º StackOverflow å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaVMStackSOF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stackLength = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stackLeak</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stackLength++;</span><br><span class="line">        stackLeak();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        JavaVMStackSOF oom = <span class="keyword">new</span> JavaVMStackSOF();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            oom.stackLeak();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Stack length: &quot;</span> + oom.stackLength);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äº <code>OutOfMemoryError</code> å°±éœ€è¦æ ¼å¤–å°å¿ƒäº†ï¼Œç¨‹åºå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ï¼ï¼ éœ€è¦å…ˆä¿å­˜å½“å‰ç³»ç»Ÿçš„å·¥ä½œï¼Œå› ä¸ºè¿™ä¸ªç¨‹åºæ¯”è¾ƒå±é™©ã€‚</span></span><br><span class="line"><span class="comment"> * å¯èƒ½ä¼šé€ æˆç³»ç»Ÿå‡æ­»æˆ–è€…å…¶ä»–å¼‚å¸¸ï¼ˆç”šè‡³å¼ºåˆ¶é‡å¯æ‰å¯ä»¥ä½¿ç”¨ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * VM Args: -Xss2m</span></span><br><span class="line"><span class="comment"> * -Xss: å‡å°‘æ ˆå†…å­˜å®¹é‡</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨çº¿ç¨‹æ¥åˆ¶é€ å†…å­˜æº¢å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaVMStackOOM</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dontStop</span><span class="params">()</span> </span>&#123; <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;&#125; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stackLeakByThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; dontStop(); &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        JavaVMStackOOM oom = <span class="keyword">new</span> JavaVMStackOOM();</span><br><span class="line">        oom.stackLeakByThread();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰"><a href="#3-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰" class="headerlink" title="3. æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰"></a>3. æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</h1><p>æœ¬åœ°æ–¹æ³•æ ˆâ€œé›·åŒâ€è™šæ‹Ÿæœºæ ˆçš„åŠŸèƒ½ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå‰è€…è®°å½•çš„æ˜¯æœ¬åœ°æ–¹æ³•çš„æ‰§è¡Œè®°å½•ï¼Œåè€…æ˜¯Javaç¨‹åºçš„æ‰§è¡Œè®°å½•ã€‚</p>
<p>å› ä¸ºè¿™ä¸ªåŒºåŸŸåœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å¹¶æ²¡æœ‰è¯¦ç»†è§„å®šæœ¬åœ°æ–¹æ³•çš„å®ç°è¯­è¨€å’Œæ•°æ®ç»“æ„ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºå¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦æ¥è¿›è¡Œæ‰©å±•ã€‚åªä¸è¿‡ï¼Œåœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œæ˜¯æŠŠè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆç»Ÿä¸€æ”¾åˆ°ä¸€èµ·äº†çš„ã€‚</p>
<p>åœ¨å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ä¸Šï¼Œå’Œè™šæ‹Ÿæœºæ ˆä¸€æ ·æ ·ï¼š</p>
<ol>
<li>å¦‚æœçº¿ç¨‹æ‰€åˆ›å»ºçš„æ ˆå¸§ä¸ªæ•°å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆæŠ›å‡º <code>StackOverflowError</code> å¼‚å¸¸ã€‚</li>
<li>å¦‚æœåœ¨åˆ›å»ºæ ˆå¸§çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºå†…å­˜ä¸è¶³æ‰€å¤±è´¥äº†ï¼Œåˆ™ä¼šæŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</li>
</ol>
<h1 id="4-å †ï¼ˆHeapï¼‰"><a href="#4-å †ï¼ˆHeapï¼‰" class="headerlink" title="4. å †ï¼ˆHeapï¼‰"></a>4. å †ï¼ˆHeapï¼‰</h1><p>æ­¤å †éå½¼å †ï¼Œä¸æ˜¯åŒä¸€å †ğŸ¤ªã€‚ä¸Šç¯‡æ–‡ç« è¯´åˆ°çš„<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/kR70YJCAmD7Ym6zd1l4w7w">ã€Šæ¢ç´¢STLï¼šå †æ•°æ®ç»“æ„åŠç®—æ³•ã€‹</a>ï¼Œå’Œè¿™é‡Œçš„å †å®Œå…¨ä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚æ›´ä½•å†µï¼Œè¿™ä¸ªå †æ˜¯Javaè™šæ‹Ÿæœºçš„ä¸œè¥¿ï¼Œé‚£ä¸ªæ˜¯C++çš„ä¸œè¥¿ï¼Œä¸¤ä¸ªæ··æ·†äº†ä¸å¤§å¥½å§ğŸ˜ã€‚</p>
<p>Javaå †å¯ä»¥è¯´æ˜¯æ•´ä¸ªJavaè™šæ‹Ÿæœºä¸­æœ€çµæ´»çš„åœ°æ–¹äº†ï¼Œä¹Ÿæ˜¯æœ€å€¼å¾—ç ”ç©¶çš„åœ°æ–¹äº†ï¼Œç›®å‰å¥½å¤šç ”ç©¶éƒ½æ˜¯å›´ç»•è¿™ä¸ªåŒºåŸŸçš„åƒåœ¾æ”¶é›†ï¼ˆGarbage Collection, GCï¼‰å±•å¼€çš„ã€‚è¿™ä¸ªåŒºåŸŸåœ¨Javaè™šæ‹Ÿæœºå¯åŠ¨ä¹‹åˆå°±åˆ›å»ºå¥½äº†ï¼Œç»™æ‰€æœ‰çº¿ç¨‹å…±äº«ä½¿ç”¨ï¼Œè¿™é‡Œå­˜æ”¾çš„å”¯ä¸€å†…å®¹å°±æ˜¯å¯¹è±¡å®ä¾‹ï¼Œæ‹¿ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­çš„æè¿°æ¥è¯´å°±æ˜¯ï¼š</p>
<blockquote>
<p>  The heap is the runtime data area from which memory for all class instances and arrays is allocated.</p>
</blockquote>
<p>è¿™ä¸€å—å†…å­˜æ˜¯è®¾è®¡æˆå¯æ‰©å±•çš„ï¼Œä½¿ç”¨å‚æ•° <code>-Xmx</code> å’Œ <code>-Xms</code> æ¥è®¾å®šå…è®¸çš„æœ€å¤§å†…å­˜å’Œå…è®¸çš„æœ€å°å†…å­˜ã€‚å½“å†…å­˜ä¸å¤Ÿå®Œæˆå®ä¾‹çš„åˆ›å»ºä¹Ÿä¸èƒ½å®Œæˆå†…å­˜æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p>
<h2 id="4-1-å †å†…å­˜æº¢å‡ºç¨‹åºç¤ºä¾‹"><a href="#4-1-å †å†…å­˜æº¢å‡ºç¨‹åºç¤ºä¾‹" class="headerlink" title="4.1 å †å†…å­˜æº¢å‡ºç¨‹åºç¤ºä¾‹"></a>4.1 å †å†…å­˜æº¢å‡ºç¨‹åºç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -Xms è®¾ç½®æœ€å°å€¼</span></span><br><span class="line"><span class="comment"> * -Xmx è®¾ç½®æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment"> * -XX:+HeapDumpOnOutOfMemoryError  å½“å‡ºç°å†…å­˜æº¢å‡ºå¼‚å¸¸æ—¶ï¼ŒDumpå‡ºå½“å‰çš„å†…å­˜è½¬å‚¨å¿«ç…§</span></span><br><span class="line"><span class="comment"> * VM Args: -Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * å †å†…å­˜æº¢å‡ºå¼‚å¸¸æµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeapOOM</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OOMObject</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;OOMObject&gt; list = <span class="keyword">new</span> ArrayList&lt;OOMObject&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> OOMObject());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="5-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰"><a href="#5-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰" class="headerlink" title="5. æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰"></a>5. æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</h1><p>è¿™ä¸ªåŒºåŸŸä¹Ÿæ˜¯çº¿ç¨‹å…±äº«åŒºåŸŸï¼Œé‡Œé¢å­˜æ”¾äº†è¢«è™šæ‹ŸæœºåŠ è½½è¿›æ¥çš„ï¼š</p>
<ul>
<li>ç±»ä¿¡æ¯</li>
<li>å¸¸é‡ã€é™æ€å˜é‡</li>
<li>å³æ—¶ç¼–è¯‘åçš„ç¨‹åº</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªç‰ˆæœ¬åˆ†æ­§ï¼ŒJDK6åŠä»¥å‰çš„ç‰ˆæœ¬ï¼Œæ–¹æ³•åŒºä½¿ç”¨åˆ†ä»£è®¾è®¡æ¥å®ç°è¯¥åŒºåŸŸï¼Œä½†æ˜¯JDK7å°±å¼€å§‹ä¸ä¸€æ ·äº†ï¼Œé¦–å…ˆæ˜¯åœ¨JDK7å§æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ç§»å‡ºåˆ°äº†æœ¬åœ°å†…å­˜ä¸­ï¼Œåˆ°äº†JDK8ï¼Œå½»åº•å°†æ–¹æ³•åŒºçš„åˆ†ä»£è®¾è®¡æŠ›å¼ƒäº†ï¼Œæ¢æˆäº†ä½¿ç”¨æœ¬åœ°å†…å­˜å®ç°çš„â€œå…ƒç©ºé—´â€ä»£æ›¿ã€‚</p>
<p>è¿™ä¸ªç©ºé—´åœ¨ä¸èƒ½æ»¡è¶³æ–°çš„å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼ŒæŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p>
<h2 id="4-1-æ–¹æ³•åŒºå†…å­˜æº¢å‡ºç¤ºä¾‹ç¨‹åº"><a href="#4-1-æ–¹æ³•åŒºå†…å­˜æº¢å‡ºç¤ºä¾‹ç¨‹åº" class="headerlink" title="4.1 æ–¹æ³•åŒºå†…å­˜æº¢å‡ºç¤ºä¾‹ç¨‹åº"></a>4.1 æ–¹æ³•åŒºå†…å­˜æº¢å‡ºç¤ºä¾‹ç¨‹åº</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * VM Args: -XX:PermSize=10m -XX:MaxPermSize=10m -XX:+HeapDumpOnOutOfMemoryError</span></span><br><span class="line"><span class="comment"> * ä¸Šé¢è¿™ä¸ªè®¾ç½®æ˜¯æ²¡ç”¨çš„ï¼Œå› ä¸ºä»JDK8å¼€å§‹ï¼ŒHotSpotè™šæ‹Ÿæœºå°±æ²¡æœ‰äº†æ°¸ä¹…ä»£è¿™ä¹ˆä¸€è¯´ï¼Œå˜æˆäº†å…ƒç©ºé—´å¯é€šè¿‡è¿™æ ·è®¾ç½®æ¥å®ç°ï¼š</span></span><br><span class="line"><span class="comment"> * VM Args: -XX:MaxMetaspaceSize=10m</span></span><br><span class="line"><span class="comment"> * -XX:MaxMetaspaceSize=10m è®¾ç½®æœ€å¤§å…ƒç©ºé—´ï¼Œé»˜è®¤æ˜¯-1ï¼Œå³ä¸è®¾ç½®å¤§å°ï¼ˆå—é™äºæœ¬åœ°ï¼‰</span></span><br><span class="line"><span class="comment"> * -XX:MetaspaceSize=10m    è®¾ç½®å…ƒç©ºé—´çš„åˆå§‹ç©ºé—´å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œå¦‚æœè¾¾åˆ°äº†è¯¥å€¼ï¼Œå°±ä¼šè§¦å‘åƒåœ¾æ”¶é›†ï¼Œå¹¶ä¸”ä¼šè°ƒæ•´å…ƒç©ºé—´çš„å¤§å°</span></span><br><span class="line"><span class="comment"> * -XX:MinMetaspaceFreeRatio</span></span><br><span class="line"><span class="comment"> * æŠ¥é”™ä¸ºï¼šException in thread &quot;main&quot; java.lang.OutOfMemoryError: Metaspace</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JVMMethodAreaOOM</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OOMObject</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">            enhancer.setSuperclass(OOMObject.class);</span><br><span class="line">            enhancer.setUseCache(<span class="keyword">false</span>);</span><br><span class="line">            enhancer.setCallback(<span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> methodProxy.invokeSuper(o, objects);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            enhancer.create();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-1-è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime-Constant-Poolï¼‰"><a href="#5-1-è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime-Constant-Poolï¼‰" class="headerlink" title="5.1 è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰"></a>5.1 è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰</h2><p>è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„åŒºåŸŸğŸ˜‰</p>
<p>é¦–å…ˆå®ƒæ˜¯æ–¹æ³•åŒºçš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œåœ¨ç±»æ–‡ä»¶ä¸­æœ‰ä¸€éƒ¨åˆ†å†…å®¹æ˜¯<strong>å¸¸é‡æ± è¡¨</strong>ï¼Œè¿™éƒ¨åˆ†å†…å®¹å­˜æ”¾äº†åœ¨ç¼–è¯‘å™¨ç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œåœ¨ç±»åŠ è½½åæ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡ä¸­ã€‚</p>
<p>è¿è¡Œæ—¶å¸¸é‡æ± å…·å¤‡åŠ¨æ€ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å°†è¿è¡ŒæœŸäº§ç”Ÿçš„å¸¸é‡æ”¾åˆ°æ± å­ä¸­ï¼Œä¾‹å¦‚ <code>String.intern()</code> æ–¹æ³•ã€‚</p>
<p>åŒæ–¹æ³•åŒºå¼‚å¸¸ä¸€æ ·ï¼Œåœ¨å†…å­˜ç”³è¯·ä¸è¶³çš„æ—¶å€™ï¼Œä¼šæŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p>
<h3 id="5-1-1-è¿è¡Œæ—¶å¸¸é‡æ± å¼‚å¸¸ç¤ºä¾‹ç¨‹åº"><a href="#5-1-1-è¿è¡Œæ—¶å¸¸é‡æ± å¼‚å¸¸ç¤ºä¾‹ç¨‹åº" class="headerlink" title="5.1.1 è¿è¡Œæ—¶å¸¸é‡æ± å¼‚å¸¸ç¤ºä¾‹ç¨‹åº"></a>5.1.1 è¿è¡Œæ—¶å¸¸é‡æ± å¼‚å¸¸ç¤ºä¾‹ç¨‹åº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * VM Args: -Xmx2m</span></span><br><span class="line"><span class="comment"> * å› ä¸ºJDK8å·²ç»æŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ç§»åˆ°äº† Javaå † ä¸­ï¼Œ</span></span><br><span class="line"><span class="comment"> * æ‰€ä»¥é™åˆ¶äº†å †å¤§å°ä¹‹åï¼Œä¼šæ¨¡æ‹Ÿå‡ºæ¥å †å†…å­˜æº¢å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RuntimeConstantPoolOOM</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        <span class="keyword">short</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            set.add(String.valueOf(i++).intern());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="6-ç›´æ¥å†…å­˜ï¼ˆDirect-Memoryï¼‰"><a href="#6-ç›´æ¥å†…å­˜ï¼ˆDirect-Memoryï¼‰" class="headerlink" title="6. ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰"></a>6. ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</h1><p>å¦‚æœæŸ¥ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ï¼Œå¹¶ä¸èƒ½å¤Ÿæ‰¾åˆ°è¿™éƒ¨åˆ†å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¹¶ä¸æ˜¯è™šæ‹Ÿæœºçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å®¹ç»å¸¸è¢«ä½¿ç”¨åˆ°ï¼Œä¸¾ä¸ªä¾‹å­ï¼šJDK1.4ä¹‹åå‡ºç°çš„NIOï¼ˆNew Input/Outputï¼‰ï¼Œè®°èµ·æ¥äº†å§ï¼ŸğŸ˜¯è¿™ä¸ªåŸºäºç¼“å†²åŒºï¼ˆBufferï¼‰å’Œé€šé“ï¼ˆChannelï¼‰çš„I/Oæ¨¡å‹ã€‚ä½¿ç”¨æœ¬åœ°å‡½æ•°ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ <code>DirectByteBuffer</code> å¯¹è±¡ä½œä¸ºç”³è¯·åˆ°çš„å †å¤–å†…å­˜å¼•ç”¨ï¼Œå¯ä»¥çœå»åœ¨Javaå †å’Œæœ¬åœ°å†…å­˜ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚</p>
<p>å¾ˆæ˜æ˜¾ï¼Œæ—¢ç„¶ä¸å±äºJavaè™šæ‹Ÿæœºçš„èŒƒç•´ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šè¢«Javaè™šæ‹Ÿæœºå¤§å°æ‰€é™åˆ¶ï¼Œä¸è¿‡ï¼Œä»ç„¶è¦å—åˆ°æœ¬æœºå†…å­˜çš„é™åˆ¶ã€‚å½“å†…å­˜ç”³è¯·å¤±è´¥æ—¶ï¼Œä¼šæŠ›å‡º <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p>
<h2 id="6-1-ç›´æ¥å†…å­˜å¼‚å¸¸ç¤ºä¾‹ç¨‹åº"><a href="#6-1-ç›´æ¥å†…å­˜å¼‚å¸¸ç¤ºä¾‹ç¨‹åº" class="headerlink" title="6.1 ç›´æ¥å†…å­˜å¼‚å¸¸ç¤ºä¾‹ç¨‹åº"></a>6.1 ç›´æ¥å†…å­˜å¼‚å¸¸ç¤ºä¾‹ç¨‹åº</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * VM Args: -Xmx20m -XX:MaxDirectMemorySize=10m</span></span><br><span class="line"><span class="comment"> * -XX:MaxDirectMemorySize  è®¾ç½®æœ€å¤§ç›´æ¥å†…å­˜ï¼Œé»˜è®¤æ˜¯å’ŒJavaå †ä¿æŒä¸€è‡´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectMemoryOOM</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _1MB = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">        Field unsafeField = Unsafe.class.getDeclaredFields()[<span class="number">0</span>];</span><br><span class="line">        unsafeField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Unsafe unsafe = (Unsafe) unsafeField.get(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            unsafe.allocateMemory(_1MB);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>å¥½äº†ï¼Œå›¾é‡Œé¢å‡ºç°çš„å„ä¸ªåŒºåŸŸæ‰€èƒ½å‡ºç°çš„é—®é¢˜ï¼Œå·²ç»å·®ä¸å¤šéƒ½é‡åˆ°äº†ï¼ˆè¿™ç§ä¸»åŠ¨çŠ¯é”™çš„æœºä¼šå¯ä¸å¤šğŸ¤”ï¼‰ï¼Œä¹Ÿè¯¥ä¼‘æ¯ä¼‘æ¯ç„¶åå»å¤ä¹ è€ƒè¯•äº†å‘œå‘œå‘œå‘œå‘œğŸ˜–â€¦â€¦</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>CHerrY
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://hxz1998.gitee.io/2020/11/27/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%86%85%E5%AD%98%E5%8F%8A%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E5%BC%82%E5%B8%B8/" title="Javaè™šæ‹Ÿæœºå†…å­˜åŠå†…å­˜æº¢å‡ºå¼‚å¸¸">https://hxz1998.gitee.io/2020/11/27/Javaè™šæ‹Ÿæœºå†…å­˜åŠå†…å­˜æº¢å‡ºå¼‚å¸¸/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat-channel.jpg">
            <span class="icon">
              <i class="fa fa-wechat"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/JVM/" rel="tag"># JVM</a>
              <a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag"># è™šæ‹Ÿæœº</a>
              <a href="/tags/JVM%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/" rel="tag"># JVMæ€§èƒ½è°ƒä¼˜</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/21/%E5%A0%86%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="prev" title="å †æ•°æ®ç»“æ„">
      <i class="fa fa-chevron-left"></i> å †æ•°æ®ç»“æ„
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/28/Linux%E7%BC%96%E8%AF%91OpenJDK12/" rel="next" title="Linuxç¼–è¯‘OpenJDK12">
      Linuxç¼–è¯‘OpenJDK12 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8%E5%8C%BA%EF%BC%88Program-Counter-Register%EF%BC%89"><span class="nav-text">1. ç¨‹åºè®¡æ•°å™¨åŒºï¼ˆProgram Counter Registerï¼‰</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%EF%BC%88VM-Stack%EF%BC%89"><span class="nav-text">2. Javaè™šæ‹Ÿæœºæ ˆï¼ˆVM Stackï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E5%BC%82%E5%B8%B8%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F"><span class="nav-text">2.1 è™šæ‹Ÿæœºæ ˆå¼‚å¸¸ç¤ºä¾‹ç¨‹åº</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88%EF%BC%88Native-Method-Stack%EF%BC%89"><span class="nav-text">3. æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E5%A0%86%EF%BC%88Heap%EF%BC%89"><span class="nav-text">4. å †ï¼ˆHeapï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%A0%86%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E7%A8%8B%E5%BA%8F%E7%A4%BA%E4%BE%8B"><span class="nav-text">4.1 å †å†…å­˜æº¢å‡ºç¨‹åºç¤ºä¾‹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E6%96%B9%E6%B3%95%E5%8C%BA%EF%BC%88Method-Area%EF%BC%89"><span class="nav-text">5. æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E6%96%B9%E6%B3%95%E5%8C%BA%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F"><span class="nav-text">4.1 æ–¹æ³•åŒºå†…å­˜æº¢å‡ºç¤ºä¾‹ç¨‹åº</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0%EF%BC%88Runtime-Constant-Pool%EF%BC%89"><span class="nav-text">5.1 è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-1-%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0%E5%BC%82%E5%B8%B8%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F"><span class="nav-text">5.1.1 è¿è¡Œæ—¶å¸¸é‡æ± å¼‚å¸¸ç¤ºä¾‹ç¨‹åº</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%EF%BC%88Direct-Memory%EF%BC%89"><span class="nav-text">6. ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E5%BC%82%E5%B8%B8%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F"><span class="nav-text">6.1 ç›´æ¥å†…å­˜å¼‚å¸¸ç¤ºä¾‹ç¨‹åº</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CHerrY"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">CHerrY</p>
  <div class="site-description" itemprop="description">ç®—æ³•åˆ†æï¼ŒåŸºç¡€æ¶æ„</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxz1998" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;hxz1998" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto://huxz1998@163.com" title="E-Mail â†’ mailto:&#x2F;&#x2F;huxz1998@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 â€“ 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CHerrY</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">177k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">2:41</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>















  

  

  

</body>
</html>
